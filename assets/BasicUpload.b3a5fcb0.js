var C=Object.defineProperty,S=Object.defineProperties;var b=Object.getOwnPropertyDescriptors;var d=Object.getOwnPropertySymbols;var w=Object.prototype.hasOwnProperty,F=Object.prototype.propertyIsEnumerable;var m=(e,t,o)=>t in e?C(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,i=(e,t)=>{for(var o in t||(t={}))w.call(t,o)&&m(e,o,t[o]);if(d)for(var o of d(t))F.call(t,o)&&m(e,o,t[o]);return e},l=(e,t)=>S(e,b(t));import{bs as __unplugin_components_5,bt as useGlobSetting,h as http,d as defineComponent,bu as EyeOutlined,bv as DeleteOutlined,K as PlusOutlined,e as computed,u as useMessage,bw as useDialog,i as reactive,w as watch,r as ref,aZ as toRefs,bm as UploadOutlined,W as isString,R as ResultEnum,_ as _export_sfc,I as resolveComponent,o as openBlock,g as createElementBlock,m as createBaseVNode,M as Fragment,a2 as renderList,n as normalizeStyle,a as createVNode,q as withCtx,a3 as mergeProps,a5 as createCommentVNode,s as withDirectives,v as vShow,z as createTextVNode,a4 as toDisplayString,c as createBlock,N as NIcon,G as __unplugin_components_2,bx as __unplugin_components_9,a9 as __unplugin_components_4,by as __unplugin_components_7}from"./index.1257e8b0.js";import{c as componentSetting}from"./componentSetting.9cb0737a.js";const basicProps=l(i({},__unplugin_components_5.props),{accept:{type:String,default:".jpg,.png,.jpeg,.svg,.gif"},helpText:{type:String,default:""},maxSize:{type:Number,default:2},maxNumber:{type:Number,default:1/0},value:{type:Array,default:()=>[]},width:{type:Number,default:104},height:{type:Number,default:104},uploadType:{type:String,required:!0},type:{type:String,default:"button"},buttonText:{type:String,default:"\u70B9\u51FB\u4E0A\u4F20"}}),globSetting$1=useGlobSetting(),urlPrefix=globSetting$1.urlPrefix||"",upload={avatar:urlPrefix+"/ossFiles/avatar",ifBg:urlPrefix+"/ossFiles/ifBG",cert:urlPrefix+"/ossFiles/cert"};function uploadFile(e,t){return http.uploadFile({url:upload[e],method:"post"},t)}var BasicUpload_vue_vue_type_style_index_0_lang="";const globSetting=useGlobSetting(),_sfc_main=defineComponent({name:"BasicUpload",components:{EyeOutlined,DeleteOutlined,PlusOutlined},props:i({},basicProps),emits:["uploadChange","delete","uploadFinish"],setup(props,{emit}){const getCSSProperties=computed(()=>({width:`${props.width}px`,height:`${props.height}px`})),message=useMessage(),dialog=useDialog(),state=reactive({showModal:!1,previewUrl:"",originalImgList:[],imgList:[]});watch(()=>props.value,()=>{state.imgList=props.value.map(e=>getImgUrl(e))});function preview(e){state.showModal=!0,state.previewUrl=e}function remove(e){dialog.info({title:"\u63D0\u793A",content:"\u4F60\u786E\u5B9A\u8981\u5220\u9664\u5417\uFF1F",positiveText:"\u786E\u5B9A",negativeText:"\u53D6\u6D88",onPositiveClick:()=>{state.imgList.splice(e,1),state.originalImgList.splice(e,1),emit("uploadChange",state.originalImgList),emit("delete",state.originalImgList)},onNegativeClick:()=>{}})}function getImgUrl(e){const{imgUrl:t}=globSetting;return/(^http|https:\/\/)/g.test(e)?e:`${t}${e}`}function checkFileType(e){return componentSetting.upload.fileType.includes(e)}function beforeUpload({file:e}){const t=e.file,{maxSize:o,accept:a}=props,u=isString(a)&&a.split(",")||[];if(o&&t.size/1024/1024>=o)return message.error(`\u4E0A\u4F20\u6587\u4EF6\u6700\u5927\u503C\u4E0D\u80FD\u8D85\u8FC7${o}M`),!1;const r=componentSetting.upload.fileType;return u.length>0&&!checkFileType(t.type)?(message.error(`\u53EA\u80FD\u4E0A\u4F20\u6587\u4EF6\u7C7B\u578B\u4E3A${r.join(",")}`),!1):!0}function finish({event:Event}){const res=eval("("+Event.target.response+")"),infoField=componentSetting.upload.apiSetting.infoField,{code}=res,message=res.msg||res.message||"\u4E0A\u4F20\u5931\u8D25",result=res[infoField];if(code===ResultEnum.SUCCESS){let e=getImgUrl(result.photo);state.imgList.push(e),state.originalImgList.push(result.photo),emit("uploadChange",state.originalImgList)}else message.error(message)}const loading=ref(!1),customRequest=({file:e,data:t})=>{loading.value=!0,uploadFile(props.uploadType,Object.assign({file:e.file,data:t})).then(o=>{message.success("\u4E0A\u4F20\u6210\u529F"),loading.value=!1,emit("uploadFinish",o.data.data)})},type=ref(props.type),buttonText=ref(props.buttonText);return l(i({},toRefs(state)),{finish,customRequest,preview,remove,beforeUpload,getCSSProperties,UploadOutlined,loading,type,buttonText})}}),_hoisted_1={class:"w-full"},_hoisted_2={class:"upload"},_hoisted_3={key:0,class:"upload-card"},_hoisted_4={class:"upload-card-item-info"},_hoisted_5={class:"img-box"},_hoisted_6=["src"],_hoisted_7={class:"img-box-actions"},_hoisted_8={class:"flex flex-col justify-center"},_hoisted_9=createBaseVNode("span",{class:"upload-title"},"\u4E0A\u4F20\u56FE\u7247",-1),_hoisted_10={key:1},_hoisted_11=["src"];function _sfc_render(e,t,o,a,u,r){const g=resolveComponent("EyeOutlined"),s=NIcon,_=resolveComponent("DeleteOutlined"),f=resolveComponent("PlusOutlined"),p=__unplugin_components_5,h=__unplugin_components_2,y=__unplugin_components_9,v=__unplugin_components_4,B=__unplugin_components_7;return openBlock(),createElementBlock(Fragment,null,[createBaseVNode("div",_hoisted_1,[createBaseVNode("div",_hoisted_2,[e.type=="image"?(openBlock(),createElementBlock("div",_hoisted_3,[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.imgList,(n,c)=>(openBlock(),createElementBlock("div",{class:"upload-card-item",style:normalizeStyle(e.getCSSProperties),key:`img_${c}`},[createBaseVNode("div",_hoisted_4,[createBaseVNode("div",_hoisted_5,[createBaseVNode("img",{src:n},null,8,_hoisted_6)]),createBaseVNode("div",_hoisted_7,[createVNode(s,{size:"18",class:"mx-2 action-icon",onClick:N=>e.preview(n)},{default:withCtx(()=>[createVNode(g)]),_:2},1032,["onClick"]),createVNode(s,{size:"18",class:"mx-2 action-icon",onClick:N=>e.remove(c)},{default:withCtx(()=>[createVNode(_)]),_:2},1032,["onClick"])])])],4))),128)),e.imgList.length<e.maxNumber?(openBlock(),createElementBlock("div",{key:0,class:"upload-card-item upload-card-item-select-picture",style:normalizeStyle(e.getCSSProperties)},[createVNode(p,mergeProps(e.$props,{"file-list-style":{display:"none"},onBeforeUpload:e.beforeUpload,"custom-request":e.customRequest}),{default:withCtx(()=>[createBaseVNode("div",_hoisted_8,[createVNode(s,{size:"18",class:"m-auto"},{default:withCtx(()=>[createVNode(f)]),_:1}),_hoisted_9])]),_:1},16,["onBeforeUpload","custom-request"])],4)):createCommentVNode("",!0)])):createCommentVNode("",!0),e.type=="button"?(openBlock(),createElementBlock("div",_hoisted_10,[createVNode(p,mergeProps(e.$props,{onBeforeUpload:e.beforeUpload,"file-list-style":{display:"none"},"custom-request":e.customRequest}),{default:withCtx(()=>[createVNode(h,{style:{"margin-top":"5px"},loading:e.loading},{default:withCtx(()=>[withDirectives(createVNode(s,{component:e.UploadOutlined,style:{"margin-right":"5px","font-size":"18px"}},null,8,["component"]),[[vShow,!e.loading]]),createTextVNode(" "+toDisplayString(e.loading?"\u6B63\u5728\u4E0A\u4F20":e.buttonText),1)]),_:1},8,["loading"])]),_:1},16,["onBeforeUpload","custom-request"])])):createCommentVNode("",!0)]),createVNode(v,null,{default:withCtx(()=>[e.helpText?(openBlock(),createBlock(y,{key:0,title:"\u63D0\u793A",type:"info",class:"flex w-full"},{default:withCtx(()=>[createTextVNode(toDisplayString(e.helpText),1)]),_:1})):createCommentVNode("",!0)]),_:1})]),createVNode(B,{show:e.showModal,"onUpdate:show":t[0]||(t[0]=n=>e.showModal=n),preset:"card",title:"\u9884\u89C8",bordered:!1,style:{width:"520px"}},{default:withCtx(()=>[createBaseVNode("img",{src:e.previewUrl},null,8,_hoisted_11)]),_:1},8,["show"])],64)}var __unplugin_components_8=_export_sfc(_sfc_main,[["render",_sfc_render]]);export{__unplugin_components_8 as _,upload as u};
